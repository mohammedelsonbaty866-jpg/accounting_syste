<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>POS Ø¨Ù‚Ø§Ù„Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Tahoma;direction:rtl;background:#f1f5f9}
header{background:#0f172a;color:#fff;padding:12px;text-align:center;font-size:18px}
.tabs{display:flex}
.tabs button{flex:1;padding:14px;border:none;font-weight:bold;font-size:15px}
.active{background:#2563eb;color:#fff}
.container{padding:10px}
.card{background:#fff;border-radius:14px;padding:14px;
box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:10px}
input,select{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:1px solid #ccc}
button{padding:14px;border:none;border-radius:12px;font-weight:bold;font-size:15px}
.btn{background:#2563eb;color:#fff;width:100%}
.btn-success{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.row{display:flex;gap:6px}
.row>*{flex:1}
.invoice{border:2px dashed #999;border-radius:10px;padding:10px;background:#fafafa}
.item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dotted #ccc}
.total{font-size:22px;font-weight:bold;text-align:center;color:#16a34a;margin-top:10px}
.alert{color:#dc2626;font-weight:bold;text-align:center}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
@media print{
body *{visibility:hidden}
#printArea,*#printArea *{visibility:visible}
#printArea{position:absolute;top:0;right:0;width:58mm}
}
</style>
</head>

<body>

<header>ğŸ›’ Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¬ Ù…Ø­Ù…ÙˆØ¯</header>

<div class="tabs">
<button class="active" onclick="showTab('cashier',this)">Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button onclick="showTab('products',this)">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="showTab('customers',this)">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
<button onclick="showTab('reports',this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="showTab('backup',this)">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
</div>

<!-- ================= Ø§Ù„ÙƒØ§Ø´ÙŠØ± ================= -->
<div id="cashier" class="container">

<div class="card">
<div class="row">
<input id="search" placeholder="Ø¨Ø­Ø« / Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="qty" type="number" value="1" min="1">
</div>
<select id="productSelect"></select>
<button class="btn-success" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="stockAlert" class="alert"></div>
</div>

<div class="card invoice">
<div id="items"></div>
<div class="total" id="total">0</div>

<select id="payType" onchange="toggleCredit()">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>

<select id="customer" style="display:none"></select>

<button class="btn" onclick="saveInvoice()">Ø­ÙØ¸ + Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

</div>

<!-- ================= Ø§Ù„Ø£ØµÙ†Ø§Ù ================= -->
<div id="products" class="container" style="display:none">
<div class="card">
<h3>â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
<input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pPrice" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="pCode" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯">
<button class="btn" onclick="addProduct()">Ø­ÙØ¸</button>
</div>

<div class="card">
<table>
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø­Ø°Ù</th></tr></thead>
<tbody id="productTable"></tbody>
</table>
</div>
</div>

<!-- ================= Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ================= -->
<div id="customers" class="container" style="display:none">
<div class="card">
<h3>â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</h3>
<input id="cName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn" onclick="addCustomer()">Ø­ÙØ¸</button>
</div>

<div class="card">
<table>
<thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>ØªØ³Ø¯ÙŠØ¯</th><th>Ù‚ÙÙ„</th></tr></thead>
<tbody id="customerTable"></tbody>
</table>
</div>
</div>

<!-- ================= Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ================= -->
<div id="reports" class="container" style="display:none">
<div class="card">
<button class="btn" onclick="dailyReport()">ğŸ“… ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</button>
<button class="btn" onclick="monthlyReport()">ğŸ—“ï¸ ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</button>
<button class="btn-danger" onclick="closeDay()">ğŸ”’ Ù‚ÙÙ„ Ø§Ù„ÙŠÙˆÙ…</button>
<div id="report"></div>
</div>
</div>

<!-- ================= Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ================= -->
<div id="backup" class="container" style="display:none">
<div class="card">
<button class="btn" onclick="exportData()">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
<input type="file" onchange="importData(event)">
</div>
</div>

<div id="printArea"></div>

<script>
/* ===== Ø£Ø¯ÙˆØ§Øª ===== */
function safe(k,d){try{return JSON.parse(localStorage.getItem(k))||d}catch{return d}}
let products=safe("products",[]);
let customers=safe("customers",[]);
let invoices=safe("invoices",[]);
let dayClosed=safe("dayClosed",false);
let cart=[];
let invoiceNo=+localStorage.getItem("invoiceNo")||1;

/* ===== ØªØ¨ÙˆÙŠØ¨ ===== */
function showTab(id,btn){
document.querySelectorAll(".container").forEach(d=>d.style.display="none");
document.getElementById(id).style.display="block";
document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
renderAll();
}

/* ===== ÙƒØ§Ø´ÙŠØ± ===== */
search.oninput=renderProducts;
function renderProducts(){
productSelect.innerHTML="";
let v=search.value.toLowerCase();
products.forEach((p,i)=>{
if(p.n.toLowerCase().includes(v)||p.c===search.value)
productSelect.innerHTML+=`<option value="${i}">${p.n} (${p.s})</option>`;
});
stockAlert.innerHTML=products.filter(p=>p.s<=5).map(p=>"âš ï¸ "+p.n).join("<br>");
}
function addItem(){
if(dayClosed)return alert("Ø§Ù„ÙŠÙˆÙ… Ù…Ù‚ÙÙˆÙ„");
let i=productSelect.value,q=+qty.value;
if(i===""||q<=0)return;
let p=products[i];
let e=cart.find(x=>x.n===p.n);
if(e){if(e.q+q>p.s)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø§ ÙŠÙƒÙÙŠ");e.q+=q;}
else{if(q>p.s)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø§ ÙŠÙƒÙÙŠ");cart.push({n:p.n,p:p.p,q});}
renderInvoice();
}
function renderInvoice(){
let t=0;items.innerHTML="";
cart.forEach(i=>{t+=i.p*i.q;items.innerHTML+=`<div class="item"><span>${i.n} Ã— ${i.q}</span><span>${i.p*i.q}</span></div>`});
total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}
function toggleCredit(){
customer.style.display=payType.value==="credit"?"block":"none";
renderCustomersSelect();
}
function saveInvoice(){
if(!cart.length)return;
let t=cart.reduce((a,i)=>a+i.p*i.q,0);
if(payType.value==="credit"){
let c=customers[customer.value];
if(!c||c.locked)return alert("Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚ÙÙˆÙ„");
c.balance+=t;
}
cart.forEach(i=>products.find(p=>p.n===i.n).s-=i.q);
let date=new Date().toLocaleString();
invoices.push({no:invoiceNo++,total:t,type:payType.value,date});
localStorage.setItem("invoiceNo",invoiceNo);
saveAll();
printInvoice(invoiceNo-1,date,[...cart],t);
cart=[];renderInvoice();renderAll();
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
function printInvoice(no,date,items,t){
printArea.innerHTML=`<div style="text-align:center">
<b>Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¬ Ù…Ø­Ù…ÙˆØ¯</b><br>
ÙØ§ØªÙˆØ±Ø© ${no}<br>${date}<br>----------------<br>
${items.map(i=>`${i.n}<br>${i.q} Ã— ${i.p} = ${i.p*i.q}`).join("<br>")}
<br>----------------<br><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t}</b></div>`;
window.print();
}

/* ===== Ø£ØµÙ†Ø§Ù ===== */
function addProduct(){
products.push({n:pName.value,p:+pPrice.value,s:+pQty.value||0,c:pCode.value||""});
saveAll();pName.value=pPrice.value=pQty.value=pCode.value="";renderAll();
}
function renderProductsTable(){
productTable.innerHTML="";
products.forEach((p,i)=>{
productTable.innerHTML+=`<tr><td>${p.n}</td><td>${p.p}</td><td>${p.s}</td>
<td><button class="btn-danger" onclick="products.splice(${i},1);saveAll();renderAll()">âœ–</button></td></tr>`;
});
}

/* ===== Ø¹Ù…Ù„Ø§Ø¡ ===== */
function addCustomer(){
customers.push({n:cName.value,balance:0,locked:false});
saveAll();cName.value="";renderAll();
}
function renderCustomers(){
customerTable.innerHTML="";
customers.forEach((c,i)=>{
customerTable.innerHTML+=`<tr>
<td>${c.n}</td><td>${c.balance}</td>
<td><button onclick="let a=+prompt('Ù…Ø¨Ù„Øº');if(a){c.balance-=a;saveAll();renderAll()}">ØªØ³Ø¯ÙŠØ¯</button></td>
<td><button onclick="c.locked=!c.locked;saveAll();renderAll()">${c.locked?'Ù…Ù‚ÙÙˆÙ„':'Ù…ÙØªÙˆØ­'}</button></td>
</tr>`;
});
}
function renderCustomersSelect(){
customer.innerHTML="";
customers.forEach((c,i)=>customer.innerHTML+=`<option value="${i}">${c.n}</option>`);
}

/* ===== ØªÙ‚Ø§Ø±ÙŠØ± ===== */
function dailyReport(){
let d=new Date().toLocaleDateString();
let r=invoices.filter(i=>i.date.includes(d));
report.innerHTML="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…: "+r.reduce((a,i)=>a+i.total,0);
}
function monthlyReport(){
let m=new Date().getMonth();
let r=invoices.filter(i=>new Date(i.date).getMonth()===m);
report.innerHTML="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±: "+r.reduce((a,i)=>a+i.total,0);
}
function closeDay(){
dayClosed=true;localStorage.setItem("dayClosed",true);alert("ØªÙ… Ù‚ÙÙ„ Ø§Ù„ÙŠÙˆÙ…");
}

/* ===== Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ===== */
function exportData(){
let data={products,customers,invoices,invoiceNo};
let a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([JSON.stringify(data)],{type:"application/json"}));
a.download="backup.json";a.click();
}
function importData(e){
let r=new FileReader();
r.onload=()=>{let d=JSON.parse(r.result);products=d.products;customers=d.customers;invoices=d.invoices;invoiceNo=d.invoiceNo;saveAll();renderAll();};
r.readAsText(e.target.files[0]);
}

/* ===== Ø­ÙØ¸ ===== */
function saveAll(){
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("customers",JSON.stringify(customers));
localStorage.setItem("invoices",JSON.stringify(invoices));
}

/* ===== ØªØ´ØºÙŠÙ„ ===== */
function renderAll(){renderProducts();renderProductsTable();renderCustomers();renderCustomersSelect();}
renderAll();
</script>

</body>
</html>
