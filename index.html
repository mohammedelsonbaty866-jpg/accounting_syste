<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… ÙÙˆØ§ØªÙŠØ± ØªØ¬Ø§Ø±ÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
--main:#0f172a;
--accent:#22c55e;
--danger:#ef4444;
--bg:#f1f5f9;
--card:#ffffff;
}

body{
margin:0;
font-family:Tahoma,Arial;
direction:rtl;
background:var(--bg);
}

header{
background:linear-gradient(90deg,#0f172a,#1e293b);
color:#fff;
padding:18px;
text-align:center;
}

nav{
display:flex;
background:#fff;
border-bottom:1px solid #ddd;
}
nav button{
flex:1;
padding:14px;
border:none;
background:none;
font-size:14px;
}
nav button:hover{background:#f1f5f9}

.container{padding:12px}

.card{
background:var(--card);
padding:14px;
margin-bottom:12px;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,.08);
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:10px;
}

.stat{
padding:12px;
border-radius:8px;
color:#fff;
text-align:center;
font-size:14px;
}
.stat span{font-size:18px;font-weight:bold}

.s1{background:#22c55e}
.s2{background:#ef4444}
.s3{background:#0ea5e9}
.s4{background:#8b5cf6}
.s5{background:#f59e0b}

input,select{
width:100%;
padding:10px;
margin:6px 0;
border-radius:6px;
border:1px solid #ccc;
}

button{
width:100%;
padding:12px;
margin-top:6px;
border:none;
border-radius:6px;
font-size:14px;
cursor:pointer;
}

.btn-main{background:var(--accent);color:#fff}
.btn-dark{background:var(--main);color:#fff}

.hidden{display:none}

/* Ø·Ø¨Ø§Ø¹Ø© Ø­Ø±Ø§Ø±ÙŠØ© */
#printArea{
width:80mm;
font-size:12px;
}
@media print{
body *{visibility:hidden}
#printArea, #printArea *{visibility:visible}
#printArea{position:absolute;top:0;right:0}
}
</style>
</head>

<body>

<header>
<h2 id="shopName">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„</h2>
<small>Ù†Ø¸Ø§Ù… ÙÙˆØ§ØªÙŠØ± ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª</small>
</header>

<nav>
<button onclick="show('dashboard')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
<button onclick="show('invoice')">ğŸ§¾ ÙØ§ØªÙˆØ±Ø©</button>
<button onclick="show('partners')">ğŸ‘¥ Ø¹Ù…Ù„Ø§Ø¡</button>
<button onclick="show('settings')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div class="container">

<!-- ===== Dashboard ===== -->
<div id="dashboard" class="card">
<h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>

<div class="grid">
<div class="stat s1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª<br><span id="sales">0</span></div>
<div class="stat s2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª<br><span id="buys">0</span></div>
<div class="stat s3">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­<br><span id="profit">0</span></div>
<div class="stat s4">Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±<br><span id="count">0</span></div>
<div class="stat s5">Ø£Ø¹Ù„Ù‰ Ø¹Ù…ÙŠÙ„<br><span id="topClient">-</span></div>
</div>

<br>
<div id="lastInvoice"></div>
</div>

<!-- ===== ÙØ§ØªÙˆØ±Ø© ===== -->
<div id="invoice" class="card hidden">
<b>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="invoiceNo"></span></b>

<select id="partner"></select>
<input id="desc" placeholder="Ø§Ù„ÙˆØµÙ">
<input id="amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">

<input id="tax" type="number" placeholder="Ø¶Ø±ÙŠØ¨Ø© %">
<input id="discount" type="number" placeholder="Ø®ØµÙ…">

<select id="type">
<option value="income">Ø¨ÙŠØ¹</option>
<option value="expense">Ø´Ø±Ø§Ø¡</option>
</select>

<button class="btn-main" onclick="addInvoice()">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
<button class="btn-dark" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- ===== Ø¹Ù…Ù„Ø§Ø¡ ===== -->
<div id="partners" class="card hidden">
<input id="partnerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn-main" onclick="addPartner()">Ø¥Ø¶Ø§ÙØ©</button>
<ul id="partnerList"></ul>
</div>

<!-- ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== -->
<div id="settings" class="card hidden">
<input id="shopNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
<button class="btn-main" onclick="saveSettings()">Ø­ÙØ¸</button>
</div>

</div>

<!-- ===== Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ===== -->
<div id="printArea" class="hidden">
<h3 id="pShop"></h3>
<div id="printContent"></div>
<p style="text-align:center">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…</p>
</div>

<script>
let partners=JSON.parse(localStorage.getItem("partners"))||[];
let invoices=JSON.parse(localStorage.getItem("invoices"))||[];
let counter=Number(localStorage.getItem("counter"))||1;

invoiceNo.innerText=counter;
shopName.innerText=localStorage.getItem("shopName")||"Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„";

function show(id){
["dashboard","invoice","partners","settings"].forEach(x=>{
document.getElementById(x).classList.add("hidden");
});
document.getElementById(id).classList.remove("hidden");
}

function save(){
localStorage.setItem("partners",JSON.stringify(partners));
localStorage.setItem("invoices",JSON.stringify(invoices));
localStorage.setItem("counter",counter);
}

function addPartner(){
if(partnerName.value){
partners.push(partnerName.value);
partnerName.value="";
save();
renderPartners();
}
}

function renderPartners(){
partner.innerHTML="";
partnerList.innerHTML="";
partners.forEach(p=>{
partner.innerHTML+=`<option>${p}</option>`;
partnerList.innerHTML+=`<li>${p}</li>`;
});
}

function addInvoice(){
let a=+amount.value;
let taxv=+tax.value||0;
let disc=+discount.value||0;
let total=a + (a*taxv/100) - disc;

invoices.push({
no:counter,
p:partner.value,
a,total,
t:type.value,
date:new Date().toLocaleString()
});
counter++;
save();
invoiceNo.innerText=counter;
renderDashboard();
alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
}

function renderDashboard(){
let sales=0,buys=0;
let clientSum={};

invoices.forEach(i=>{
if(i.t==="income") sales+=i.total;
else buys+=i.total;

clientSum[i.p]=(clientSum[i.p]||0)+i.total;
});

let top="-",max=0;
for(let c in clientSum){
if(clientSum[c]>max){max=clientSum[c];top=c;}
}

document.getElementById("sales").innerText=sales;
document.getElementById("buys").innerText=buys;
document.getElementById("profit").innerText=sales-buys;
document.getElementById("count").innerText=invoices.length;
document.getElementById("topClient").innerText=top;

if(invoices.length){
let l=invoices[invoices.length-1];
lastInvoice.innerHTML=`Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø©: #${l.no} - ${l.p} - ${l.total}`;
}
}

function saveSettings(){
localStorage.setItem("shopName",shopNameInput.value);
shopName.innerText=shopNameInput.value;
}

function printInvoice(){
let i=invoices[invoices.length-1];
pShop.innerText=shopName.innerText;
printContent.innerHTML=`
ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù…: ${i.no}<br>
Ø§Ù„Ø¹Ù…ÙŠÙ„: ${i.p}<br>
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${i.total}<br>
${i.date}
`;
printArea.classList.remove("hidden");
window.print();
printArea.classList.add("hidden");
}

renderPartners();
renderDashboard();
</script>

</body>
</html>
