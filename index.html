<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ÙŠØ±</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e3a8a">

<style>
body{margin:0;font-family:Tahoma;background:#f1f5f9}
header{background:#1e3a8a;color:#fff;padding:10px;text-align:center}
button{padding:10px;margin:3px;border:0;border-radius:8px;font-size:15px}
.btn{background:#2563eb;color:#fff}
input,select{padding:8px;width:100%;margin:3px;border-radius:6px;border:1px solid #ccc}
#cashier{padding:10px}
#items{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.card{background:#fff;border-radius:8px;padding:6px;border:1px solid #ddd}
#total{font-size:18px;font-weight:bold;margin:8px}
#sideMenu button{width:100%;margin:5px 0}
#sideMenu{position:fixed;right:-220px;top:0;width:200px;height:100%;
background:#1e3a8a;color:#fff;padding:10px;transition:.3s;z-index:9}
.hidden{display:none}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<header id="shopTitle">Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</header>

<button onclick="toggleMenu()" style="position:fixed;right:10px;top:10px;font-size:22px;z-index:10">â˜°</button>

<div id="sideMenu">
<button onclick="showTab('cashier')">ğŸ§¾ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="showTab('customers')">ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
<button onclick="showTab('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="showTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<!-- Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
<div id="cashier">
<input id="search" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù / Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="qty" type="number" value="1">
<select id="payType" onchange="toggleCustomer()">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>

<select id="customerSelect" class="hidden"></select>

<button class="btn" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ©</button>
<button class="btn" onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø©</button>

<div id="items"></div>
<div id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
</div>

<!-- Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<div id="products" class="hidden">
<h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<input id="pn" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pp" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<input id="pc" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="ps" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">
<button class="btn" onclick="addProduct()">Ø­ÙØ¸</button>
</div>

<!-- Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
<div id="customers" class="hidden">
<h3>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
<input id="cn" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn" onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="clist"></div>
</div>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
<div id="reports" class="hidden">
<h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
<div id="rdata"></div>
</div>

<!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div id="settings" class="hidden">
<h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ù„</h3>
<input id="shopName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„">
<button class="btn" onclick="saveSettings()">Ø­ÙØ¸</button>
</div>

<div id="printArea" class="hidden"></div>

<script>
let products=JSON.parse(localStorage.products||"[]");
let customers=JSON.parse(localStorage.customers||"[]");
let invoices=JSON.parse(localStorage.invoices||"[]");
let settings=JSON.parse(localStorage.settings||"{}");

let cart=[];
let invoiceNo=invoices.length+1;

function saveAll(){
localStorage.products=JSON.stringify(products);
localStorage.customers=JSON.stringify(customers);
localStorage.invoices=JSON.stringify(invoices);
localStorage.settings=JSON.stringify(settings);
}

function addProduct(){
products.push({n:pn.value,p:+pp.value,c:+pc.value,s:+ps.value});
saveAll();alert("ØªÙ…");
}

function addCustomer(){
customers.push({n:cn.value,b:0,lock:false});
saveAll();renderCustomers();renderCustomerSelect();
}

function renderCustomers(){
clist.innerHTML="";
customers.forEach((c,i)=>{
clist.innerHTML+=`
<div class="card">
<b>${c.n}</b><br>
Ø±ØµÙŠØ¯: ${c.b}<br>
<button onclick="payCustomer(${i})">Ø³Ø¯Ø§Ø¯</button>
<button onclick="toggleLock(${i})">${c.lock?"ÙØªØ­":"Ù‚ÙÙ„"}</button>
</div>`;
});
}

function renderCustomerSelect(){
customerSelect.innerHTML="";
customers.forEach((c,i)=>{
if(!c.lock)
customerSelect.innerHTML+=`<option value="${i}">${c.n}</option>`;
});
}

function toggleCustomer(){
customerSelect.classList.toggle("hidden",payType.value!="credit");
}

function addItem(){
let p=products.find(x=>x.n==search.value);
if(!p)return alert("ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
if(p.s<qty.value)return alert("Ù†ÙØ§Ø¯ Ù…Ø®Ø²ÙˆÙ†");
cart.push({n:p.n,p:p.p,c:p.c,q:+qty.value});
p.s-=qty.value;
renderInvoice();saveAll();
}

function renderInvoice(){
items.innerHTML="";let t=0;
cart.forEach(i=>{
t+=i.p*i.q;
items.innerHTML+=`
<div class="card">
<b>${i.n}</b><br>
${i.q} Ã— ${i.p}<br>
<b>${i.q*i.p}</b>
</div>`;
});
total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

function saveInvoice(){
let totalSum=cart.reduce((a,b)=>a+b.p*b.q,0);
let type=payType.value;
let cust=null;

if(type=="credit"){
let c=customers[customerSelect.value];
c.b+=totalSum;
cust=c.n;
}

let printed=[...cart];
invoices.push({no:invoiceNo++,cart:printed,total:totalSum,type,cust,date:new Date().toISOString()});
printInvoice(printed,totalSum);
cart=[];renderInvoice();saveAll();
}

function printInvoice(items,t){
let name=settings.shopName||"";
printArea.innerHTML=`
<div style="width:58mm;font-family:Courier;border:1px solid #000;padding:6px;text-align:center">
<img src="logo.png" style="width:60px"><br>
<b>${name}</b><br>
ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${invoiceNo-1}<hr>
${items.map(i=>`
<div style="border:1px solid #000;margin:3px;padding:3px">
${i.n}<br>${i.q} Ã— ${i.p} = <b>${i.q*i.p}</b>
</div>`).join("")}
<hr><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t}</b>
</div>`;
window.print();
}

function payCustomer(i){
let amt=prompt("Ø§Ù„Ù…Ø¨Ù„Øº");
if(!amt)return;
customers[i].b-=+amt;
saveAll();renderCustomers();
}

function toggleLock(i){
customers[i].lock=!customers[i].lock;
saveAll();renderCustomers();renderCustomerSelect();
}

function saveSettings(){
settings.shopName=shopName.value;
shopTitle.innerText=shopName.value||"Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±";
saveAll();alert("ØªÙ…");
}

function toggleMenu(){
sideMenu.style.right=sideMenu.style.right=="0px"?"-220px":"0px";
}

function showTab(id){
document.querySelectorAll("body > div").forEach(d=>d.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
sideMenu.style.right="-220px";
}

renderCustomers();renderCustomerSelect();
shopTitle.innerText=settings.shopName||"Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±";
</script>

<script>
if("serviceWorker"in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
