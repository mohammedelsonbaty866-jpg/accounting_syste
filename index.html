<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ ØªØ¬Ø§Ø±ÙŠ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
--main:#0f172a;
--accent:#2563eb;
--success:#16a34a;
--danger:#dc2626;
--bg:#f1f5f9;
--card:#ffffff;
}

body{
margin:0;
font-family:Tahoma,Arial;
direction:rtl;
background:var(--bg);
}

header{
background:#0f172a;
color:#fff;
padding:15px;
text-align:center;
}

nav{
display:flex;
background:#fff;
border-bottom:1px solid #ddd;
}
nav button{
flex:1;
padding:12px;
border:none;
background:none;
font-size:13px;
}
nav button:hover{background:#f1f5f9}

.container{padding:12px}

.card{
background:var(--card);
padding:14px;
margin-bottom:12px;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,.08);
}

input,select{
width:100%;
padding:10px;
margin:6px 0;
border-radius:6px;
border:1px solid #ccc;
}

button{
width:100%;
padding:12px;
margin-top:6px;
border:none;
border-radius:6px;
font-size:14px;
cursor:pointer;
}

.btn-main{background:var(--accent);color:#fff}
.btn-success{background:var(--success);color:#fff}
.btn-danger{background:var(--danger);color:#fff}

.hidden{display:none}

/* ===== ÙØ§ØªÙˆØ±Ø© Ø­Ø±Ø§Ø±ÙŠØ© ===== */
#printArea{
width:80mm;
font-size:12px;
padding:5px;
}
#printArea h3{
text-align:center;
margin:4px 0;
}
#printArea table{
width:100%;
border-collapse:collapse;
}
#printArea th,#printArea td{
border-bottom:1px dashed #000;
padding:3px;
text-align:center;
}
@media print{
body *{visibility:hidden}
#printArea, #printArea *{visibility:visible}
#printArea{position:absolute;top:0;right:0}
}
</style>
</head>

<body>

<!-- ===== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ===== -->
<div id="loginBox" class="container">
<div class="card">
<h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="loginPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>
</div>

<!-- ===== Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===== -->
<div id="app" class="hidden">

<header>
<h3>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ ØªØ¬Ø§Ø±ÙŠ</h3>
<small id="currentUser"></small>
</header>

<nav>
<button onclick="show('invoice')">ğŸ§¾ ÙØ§ØªÙˆØ±Ø©</button>
<button onclick="show('products')">ğŸ“¦ Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('users')">ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
<button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
</nav>

<div class="container">

<!-- ===== ÙØ§ØªÙˆØ±Ø© ===== -->
<div id="invoice" class="card">
<select id="productSelect"></select>
<input id="qty" type="number" value="1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="btn-success" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>

<hr>
<div id="invoiceItems"></div>
<b id="invoiceTotal">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</b>

<button class="btn-main" onclick="saveInvoice()">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
<button class="btn-success" onclick="printInvoice()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<!-- ===== Ø£ØµÙ†Ø§Ù ===== -->
<div id="products" class="card hidden">
<h3>ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<input id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="productPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<button class="btn-main" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
<ul id="productList"></ul>
</div>

<!-- ===== Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ===== -->
<div id="users" class="card hidden">
<h3>ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
<input id="newUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<input id="newPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="btn-main" onclick="addUser()">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
<ul id="userList"></ul>
</div>

</div>
</div>

<!-- ===== Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ===== -->
<div id="printArea" class="hidden">
<h3>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h3>
<div id="printMeta"></div>
<table>
<thead>
<tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ùƒ</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr>
</thead>
<tbody id="printItems"></tbody>
</table>
<hr>
<b id="printTotal"></b>
<p style="text-align:center">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…</p>
</div>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let users = JSON.parse(localStorage.getItem("users")) || [{u:"admin",p:"1234"}];
let products = JSON.parse(localStorage.getItem("products")) || [];
let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
let cart = [];
let loggedUser = localStorage.getItem("loggedUser");

/* ===== Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ===== */
if(loggedUser){
showApp(loggedUser);
}

/* ===== ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ===== */
function login(){
let u = loginUser.value;
let p = loginPass.value;
let ok = users.find(x => x.u === u && x.p === p);
if(ok){
localStorage.setItem("loggedUser",u);
showApp(u);
}else{
alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
}
}

function showApp(user){
loginBox.classList.add("hidden");
app.classList.remove("hidden");
currentUser.innerText="Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: "+user;
renderProducts();
renderUsers();
}

/* ===== Ø®Ø±ÙˆØ¬ ===== */
function logout(){
localStorage.removeItem("loggedUser");
location.reload();
}

/* ===== ØªÙ†Ù‚Ù„ ===== */
function show(id){
["invoice","products","users"].forEach(x=>{
document.getElementById(x).classList.add("hidden");
});
document.getElementById(id).classList.remove("hidden");
}

/* ===== Ø£ØµÙ†Ø§Ù ===== */
function addProduct(){
if(productName.value && productPrice.value){
products.push({n:productName.value,p:+productPrice.value});
productName.value=productPrice.value="";
save();
renderProducts();
}
}

function renderProducts(){
productSelect.innerHTML="";
productList.innerHTML="";
products.forEach((p,i)=>{
productSelect.innerHTML+=`<option value="${i}">${p.n} - ${p.p}</option>`;
productList.innerHTML+=`<li>${p.n} - ${p.p}</li>`;
});
}

/* ===== ÙØ§ØªÙˆØ±Ø© ===== */
function addItem(){
let p = products[productSelect.value];
let q = +qty.value;
cart.push({n:p.n,p:p.p,q});
renderCart();
}

function renderCart(){
let t=0;
invoiceItems.innerHTML="";
cart.forEach(i=>{
let s=i.p*i.q;
t+=s;
invoiceItems.innerHTML+=`${i.n} Ã— ${i.q} = ${s}<br>`;
});
invoiceTotal.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

function saveInvoice(){
invoices.push({
user:localStorage.getItem("loggedUser"),
items:cart,
total:cart.reduce((a,i)=>a+i.p*i.q,0),
date:new Date().toLocaleString()
});
cart=[];
save();
renderCart();
alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
}

/* ===== Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ===== */
function addUser(){
if(newUser.value && newPass.value){
users.push({u:newUser.value,p:newPass.value});
newUser.value=newPass.value="";
save();
renderUsers();
}
}

function renderUsers(){
userList.innerHTML="";
users.forEach(u=>{
userList.innerHTML+=`<li>${u.u}</li>`;
});
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
function printInvoice(){
let last=invoices[invoices.length-1];
if(!last){alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø©");return;}

printMeta.innerHTML=`
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${last.date}<br>
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${last.user}
`;

printItems.innerHTML="";
last.items.forEach(i=>{
printItems.innerHTML+=`
<tr>
<td>${i.n}</td>
<td>${i.q}</td>
<td>${i.p*i.q}</td>
</tr>`;
});
printTotal.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+last.total;

printArea.classList.remove("hidden");
window.print();
printArea.classList.add("hidden");
}

/* ===== Ø­ÙØ¸ ===== */
function save(){
localStorage.setItem("users",JSON.stringify(users));
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("invoices",JSON.stringify(invoices));
}
</script>

</body>
</html>
