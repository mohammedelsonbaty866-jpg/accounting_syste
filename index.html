<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>POS Ø¨Ù‚Ø§Ù„Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Tahoma;direction:rtl;background:#f3f4f6}
header{background:#0f172a;color:#fff;padding:10px;text-align:center}
.container{padding:10px}
.card{background:#fff;padding:10px;margin-bottom:10px;border-radius:10px}
input,select,button{width:100%;padding:10px;margin:5px 0}
button{border:none;border-radius:6px}
.btn{background:#2563eb;color:#fff}
.btn-success{background:#16a34a;color:#fff}
.btn-danger{background:#dc2626;color:#fff}
.btn-warning{background:#f59e0b;color:#fff}
.hidden{display:none}
.locked{color:red;font-weight:bold}
</style>
</head>

<body>

<header>
<h3>ğŸ›’ Ù†Ø¸Ø§Ù… Ø¨Ù‚Ø§Ù„Ø©</h3>
</header>

<div class="container">

<!-- Ø¨ÙŠØ¹ -->
<div class="card">
<input id="search" placeholder="Ø¨Ø­Ø« / Ø¨Ø§Ø±ÙƒÙˆØ¯">
<select id="productSelect"></select>
<input id="qty" type="number" value="1" min="1">
<button class="btn-success" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
</div>

<!-- ÙØ§ØªÙˆØ±Ø© -->
<div class="card">
<div id="items"></div>
<b id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</b>

<select id="payType" onchange="payChange()">
<option value="cash">Ù†Ù‚Ø¯ÙŠ</option>
<option value="credit">Ø¢Ø¬Ù„</option>
</select>

<select id="customer" class="hidden"></select>
<button class="btn" onclick="saveInvoice()">Ø­ÙØ¸</button>
</div>

<!-- Ø¹Ù…Ù„Ø§Ø¡ -->
<div class="card">
<h4>ğŸ‘¤ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¢Ø¬Ù„</h4>
<input id="custName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="btn" onclick="addCustomer()">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>

<select id="custList" onchange="showStatement()"></select>
<div id="statement"></div>

<hr>

<h4>ğŸ’³ ØªØ³Ø¯ÙŠØ¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</h4>
<input id="payAmount" type="number" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø¯Ø§Ø¯">
<button class="btn-success" onclick="payDebt()">ØªØ³Ø¯ÙŠØ¯</button>

<hr>

<h4>ğŸ”’ Ù‚ÙÙ„ / ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
<button class="btn-warning" onclick="toggleLock()">Ù‚ÙÙ„ / ÙØªØ­</button>
</div>

</div>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª ===== */
let products = JSON.parse(localStorage.getItem("products")) || [
 {n:"Ø³ÙƒØ±",p:15,s:50,c:"111"},
 {n:"Ø²ÙŠØª",p:70,s:30,c:"222"}
];
let customers = JSON.parse(localStorage.getItem("customers")) || [];
let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
let cart = [];

/* ===== Ø¨Ø­Ø« ===== */
search.oninput = () => {
 productSelect.innerHTML="";
 let v = search.value.trim();
 products.forEach((p,i)=>{
  if(p.c===v || p.n.includes(v)){
   productSelect.innerHTML += `<option value="${i}">${p.n} (Ù…ØªÙˆÙØ± ${p.s})</option>`;
  }
 });
};

/* ===== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ===== */
function addItem(){
 let idx = productSelect.value;
 if(idx==="" ) return;
 let p = products[idx];
 let q = +qty.value;
 if(q<=0 || q>p.s){ alert("ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø©"); return; }
 cart.push({n:p.n,p:p.p,q});
 render();
}

/* ===== Ø¹Ø±Ø¶ ===== */
function render(){
 let t=0;
 items.innerHTML="";
 cart.forEach(i=>{
  t+=i.p*i.q;
  items.innerHTML+=`${i.n} Ã— ${i.q} = ${i.p*i.q}<br>`;
 });
 total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

/* ===== Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹ ===== */
function payChange(){
 customer.classList.toggle("hidden", payType.value!=="credit");
 if(payType.value==="credit") loadCustomers(true);
}

/* ===== Ø­ÙØ¸ ÙØ§ØªÙˆØ±Ø© ===== */
function saveInvoice(){
 if(cart.length===0) return;
 let t = cart.reduce((a,i)=>a+i.p*i.q,0);
 let today = new Date().toLocaleDateString();

 if(payType.value==="credit"){
  if(customer.value===""){ alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„"); return; }
  let c = customers[customer.value];
  if(c.locked){ alert("Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚ÙÙˆÙ„"); return; }
  c.ops.push({date:today,type:"Ø¨ÙŠØ¹",total:t});
  c.balance += t;
 }

 cart.forEach(i=>{
  let p = products.find(x=>x.n===i.n);
  p.s -= i.q;
 });

 invoices.push({date:today,total:t,type:payType.value});
 saveAll();
 cart=[];
 render();
}

/* ===== Ø¹Ù…Ù„Ø§Ø¡ ===== */
function addCustomer(){
 if(!custName.value) return;
 customers.push({n:custName.value,balance:0,ops:[],locked:false});
 custName.value="";
 saveCustomers();
}

function loadCustomers(forSale=false){
 customer.innerHTML="";
 custList.innerHTML="";
 customers.forEach((c,i)=>{
  if(!forSale || !c.locked)
   customer.innerHTML+=`<option value="${i}">${c.n}</option>`;
  custList.innerHTML+=`<option value="${i}">${c.n}</option>`;
 });
}

function showStatement(){
 let c = customers[custList.value];
 if(!c) return;
 let html=`<b>${c.n}</b><br>`;
 html+=`Ø§Ù„Ø­Ø§Ù„Ø©: ${c.locked?'<span class="locked">Ù…Ù‚ÙÙˆÙ„</span>':'Ù…ÙØªÙˆØ­'}<br>`;
 html+=`Ø§Ù„Ø±ØµÙŠØ¯: ${c.balance}<br><hr>`;
 c.ops.forEach(o=>{
  html+=`${o.date} - ${o.type} : ${o.total}<br>`;
 });
 statement.innerHTML=html;
}

/* ===== Ø³Ø¯Ø§Ø¯ ===== */
function payDebt(){
 let amt = +payAmount.value;
 let c = customers[custList.value];
 if(!c || amt<=0 || amt>c.balance){ alert("Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­"); return; }
 c.balance -= amt;
 c.ops.push({date:new Date().toLocaleDateString(),type:"Ø³Ø¯Ø§Ø¯",total:-amt});
 payAmount.value="";
 saveCustomers();
 showStatement();
}

/* ===== Ù‚ÙÙ„ ===== */
function toggleLock(){
 let c = customers[custList.value];
 if(!c) return;
 c.locked = !c.locked;
 saveCustomers();
 showStatement();
}

/* ===== Ø­ÙØ¸ ===== */
function saveCustomers(){
 localStorage.setItem("customers", JSON.stringify(customers));
 loadCustomers();
}
function saveAll(){
 localStorage.setItem("products", JSON.stringify(products));
 localStorage.setItem("customers", JSON.stringify(customers));
 localStorage.setItem("invoices", JSON.stringify(invoices));
}
</script>

</body>
</html>
