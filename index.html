<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>POS Ø¨Ù‚Ø§Ù„Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Tahoma;direction:rtl;background:#f1f5f9}
header{background:#1e293b;color:#fff;padding:12px;text-align:center;font-size:18px}
.tabs{display:flex}
.tabs button{flex:1;padding:12px;border:none;font-weight:bold}
.active{background:#2563eb;color:#fff}
.container{padding:10px}
.card{background:#fff;border-radius:12px;padding:12px;
box-shadow:0 4px 8px rgba(0,0,0,.1);margin-bottom:10px}
input,select{width:100%;padding:10px;margin:4px 0;border-radius:8px;border:1px solid #ccc}
button{padding:12px;border:none;border-radius:10px;font-weight:bold}
.btn{background:#2563eb;color:#fff;width:100%}
.btn-danger{background:#dc2626;color:#fff}
.item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dotted #ccc}
.total{font-size:20px;font-weight:bold;text-align:center;color:#16a34a;margin-top:8px}
.alert{color:#dc2626;font-weight:bold;text-align:center}
.invoice{background:#fafafa;border:2px dashed #999;border-radius:10px;padding:10px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
@media print{
body *{visibility:hidden}
#printArea,*#printArea *{visibility:visible}
#printArea{position:absolute;top:0;right:0;width:58mm}
}
</style>
</head>

<body>

<header>ğŸ›’ Ù†Ø¸Ø§Ù… Ø¨Ù‚Ø§Ù„Ø©</header>

<div class="tabs">
<button class="active" onclick="showTab('cashier',this)">Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
<button onclick="showTab('products',this)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
</div>

<div id="cashier" class="container">
<div class="card">
<input id="search" placeholder="Ø¨Ø­Ø« Ø£Ùˆ Ø¨Ø§Ø±ÙƒÙˆØ¯">
<input id="qty" type="number" value="1" min="1">
<select id="productSelect"></select>
<button class="btn" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="stockAlert" class="alert"></div>
</div>

<div class="card invoice">
<div id="items"></div>
<div class="total" id="total">0</div>
<button class="btn" onclick="saveInvoice()">Ø­ÙØ¸ + Ø·Ø¨Ø§Ø¹Ø©</button>
</div>
</div>

<div id="products" class="container" style="display:none">
<div class="card">
<h3>â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h3>
<input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="pQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="pCode" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯">
<button class="btn" onclick="addProduct()">Ø­ÙØ¸</button>
</div>

<div class="card">
<h3>ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<table>
<thead>
<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø¨Ø§Ø±ÙƒÙˆØ¯</th><th>Ø­Ø°Ù</th></tr>
</thead>
<tbody id="productTable"></tbody>
</table>
</div>
</div>

<div id="printArea"></div>

<script>
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ===== */
const SHOP_NAME="Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¬ Ù…Ø­Ù…ÙˆØ¯";
const SHOP_PHONE="01000000000";

/* ===== ØªØ­Ù…ÙŠÙ„ Ø¢Ù…Ù† ===== */
function safeLoad(k,d){try{return JSON.parse(localStorage.getItem(k))||d}catch{return d}}
let products=safeLoad("products",[]);
let invoices=safeLoad("invoices",[]);
let cart=[];
let invoiceNo=+localStorage.getItem("invoiceNo")||1;

/* ===== ØªØ¨ÙˆÙŠØ¨ ===== */
function showTab(id,btn){
document.querySelectorAll(".container").forEach(d=>d.style.display="none");
document.getElementById(id).style.display="block";
document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
renderProducts();
}

/* ===== Ø¨Ø­Ø« ===== */
search.oninput=()=>renderProducts();
function renderProducts(){
productSelect.innerHTML="";
productTable.innerHTML="";
let v=search.value.toLowerCase();
products.forEach((p,i)=>{
if(p.n.toLowerCase().includes(v)||p.c===search.value)
productSelect.innerHTML+=`<option value="${i}">${p.n} (${p.s})</option>`;
productTable.innerHTML+=`
<tr>
<td>${p.n}</td><td>${p.p}</td><td>${p.s}</td><td>${p.c}</td>
<td><button class="btn-danger" onclick="delProduct(${i})">âœ–</button></td>
</tr>`;
});
checkStock();
}

/* ===== Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø© ===== */
function addItem(){
let i=productSelect.value,q=+qty.value;
if(i===""||q<=0)return;
let p=products[i];
let e=cart.find(x=>x.n===p.n);
if(e){if(e.q+q>p.s)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø§ ÙŠÙƒÙÙŠ");e.q+=q;}
else{if(q>p.s)return alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø§ ÙŠÙƒÙÙŠ");cart.push({n:p.n,p:p.p,q});}
renderInvoice();
}

/* ===== Ø¹Ø±Ø¶ ÙØ§ØªÙˆØ±Ø© ===== */
function renderInvoice(){
let t=0;items.innerHTML="";
cart.forEach(i=>{
t+=i.p*i.q;
items.innerHTML+=`<div class="item"><span>${i.n} Ã— ${i.q}</span><span>${i.p*i.q}</span></div>`;
});
total.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+t;
}

/* ===== Ø­ÙØ¸ ===== */
function saveInvoice(){
if(!cart.length)return;
for(let i of cart){
let p=products.find(x=>x.n===i.n);
if(!p||p.s<i.q)return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");
p.s-=i.q;
}
let t=cart.reduce((a,i)=>a+i.p*i.q,0);
let date=new Date().toLocaleString();
invoices.push({no:invoiceNo++,date,total:t,items:[...cart]});
localStorage.setItem("invoiceNo",invoiceNo);
localStorage.setItem("products",JSON.stringify(products));
localStorage.setItem("invoices",JSON.stringify(invoices));
printInvoice(invoiceNo-1,date,[...cart],t);
cart=[];renderInvoice();renderProducts();
}

/* ===== Ø·Ø¨Ø§Ø¹Ø© ===== */
function printInvoice(no,date,items,t){
printArea.innerHTML=`
<div style="text-align:center;font-family:Tahoma">
<b>${SHOP_NAME}</b><br>${SHOP_PHONE}<br>
--------------------<br>
ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… ${no}<br>${date}<br>
--------------------<br>
${items.map(i=>`${i.n}<br>${i.q} Ã— ${i.p} = ${i.p*i.q}`).join("<br>")}
--------------------<br>
<b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${t} Ø¬Ù†ÙŠÙ‡</b><br>
Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…
</div>`;
window.print();
}

/* ===== Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù ===== */
function addProduct(){
if(!pName.value||!pPrice.value)return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©");
products.push({n:pName.value,p:+pPrice.value,s:+pQty.value||0,c:pCode.value||""});
localStorage.setItem("products",JSON.stringify(products));
pName.value=pPrice.value=pQty.value=pCode.value="";
renderProducts();
}

/* ===== Ø­Ø°Ù ===== */
function delProduct(i){
if(confirm("Ø­Ø°Ù Ø§Ù„ØµÙ†ÙØŸ")){
products.splice(i,1);
localStorage.setItem("products",JSON.stringify(products));
renderProducts();
}
}

/* ===== ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø®Ø²ÙˆÙ† ===== */
function checkStock(){
stockAlert.innerHTML="";
products.forEach(p=>{if(p.s<=5)stockAlert.innerHTML+=`âš ï¸ ${p.n}<br>`});
}

renderProducts();
</script>

</body>
</html>
